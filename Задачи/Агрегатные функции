----- Часть 1 -----

/* Задача 1: Найти среднюю цену на все товары в таблице Products и округлить значение до двух символов после запятой. */
select round(AVG(prod_price::numeric),2) from products p;

/* Задача 2: Найти среднюю цену на все товары, предлагаемыми поставщиком с идентификатором 1003(или идентификатор из своей таблицы) в таблице Products. 
 * Полученный столбец назвать «Средняя стоимость» */
select AVG(prod_price::numeric) as "Средняя цена" from products p where vend_id=1003

/* Задача 3: Найти общее количество клиентов в таблице customers. Результату присвоить наименование «Количество клиентов» */
select count(*) as "Количество клиентов" from customers c 

/* Задача 4: Найти общее количество клиентов в таблице customers, у которых есть email. Результату присвоить наименование «Количество клиентов» */
select count(*) from customers c where cust_email is not null;

/* Задача 5: Найти наибольшее значение в столбце prod_price. Результату присвоить наименование «Максимальная цена» */
select max(prod_price) as "Максимальная цена" from products p

/* Задача 6: Найти наименьшее значение в столбце prod_price. Результату присвоить наименование «Минимальная цена» */
select min(prod_price) as "Максимальная цена" from products p

/* Задача 7: Найти общее количество заказанных товаров (т.е. сумму значений в столбце quantity) в таблице orderitems по заказу 20005 (или идентификатор из своей таблицы). 
* Результату присвоить наименование «Общее количество» */
select count(quantity) as "Общее количество" from orderitems о where order_num = 20005

/* Задача 8: Найти общую стоимость заказанных товаров в таблице orderitems по заказу 20005 (или идентификатор из своей таблицы). Результату присвоить наименование «Стоимость» */
select sum(item_price) as "Стоимость" 
from orderitems о
where order_num = 20005

/* Задача 9: Найти среднюю цену на все товары (учитывать только отличающиеся цены), предлагаемыми поставщиком с идентификатором 1003(или идентификатор из своей таблицы) в таблице Products. 
Полученный столбец назвать «Средняя стоимость» */
select AVG(distinct prod_price::numeric) as "Средняя стоимость" from products p where vend_id = 1003

/* Задача 10: Найти среднюю цену на все товары, наибольшее значение цены, наименьшее значение цены, количество строк в таблице Products. Полученный результат назвать соответственно «Средняя стоимость», 
«Максимальная цена», «Минимальная цена», «Общее количество» */
select AVG(prod_price::numeric) as "Средняя стоимость", max(prod_price::numeric) as "Максимальная цена", MIN(prod_price::numeric) as "Минимальная цена", count(*) as "Общее количество" from products p 

----- Часть 2 -----

/* Задача 11: Осуществить выборку поставщиков и указать количество товаров у каждого из них из таблицы products. 
 * Группировка осуществляется по поставщикам (vend_id). */
	select prod_id as "ID товара", prod_name as "Наименование товара", vend_id as "ID производителя", count(*) as "Количество товара"
	from products p  
	group by prod_id, prod_name, vend_id

/* Задача 12: Осуществить выборку клиентов и указать количество заказов у каждого из них из таблицы orderitems, если количество заказов больше или равно 2. 
 * Группировка осуществляется по клиентам (cust_id). */
	select cust_id, count(*) as "Количество заказов" 
	from orders o 
	where o.order_num >= 2
	group by cust_id
	-- having count(*) >= 2; -- фильтруются группы, затем выбираются только те, которые содержат >= 2 заказа.
	
/* Задача 13: Осуществить выборку всех поставщиков и указать количество товаров у каждого из них из таблицы products, если количество товаров больше 2. 
 * Группировка осуществляется по поставщикам (vend_id). */
	select vend_id as "ID производителя", count(*) as "Количество товара" 
	from products p 
	where p.vend_id >= 2
	group by vend_id 
		
/* Задача 14: Осуществить выборку всех поставщиков и указать количество товаров у каждого из них из таблицы products, если количество товаров больше или равно 2 по цене 10 и выше. 
 * Группировка осуществляется по поставщикам (vend_id). */
	select vend_id as "ID производителя", count(*) as "Количество товара" 
	from products p 
	where p.vend_id >= 2 and p.prod_price >= money(10)
	group by vend_id
	
/* Задача 15: Осуществить выборку номера заказа и указать общую стоимость заказов, если она больше или равна 50, из таблицы orderitems. */
	select order_num, sum(item_price) as "Стоимость"
	from orderitems о
	where item_price >= money(50)
	group by order_num
	
/* Задача 16: Осуществить выборку номера заказа, указать общую стоимость заказов, указать общее количество товаров, входящих в заказ из таблицы orderitems. */
	select order_num as "ID заказа", sum(item_price) as "Стоимость", count(quantity)"Количество товара"
	from orderitems о 
	group by order_num 

/* Задача 17: Осуществить выборку номера заказа и указать общую стоимость заказов, если она больше или равна 35, из таблицы orderitems. Итоговой сумме присвоить наименование ordertotal. 
 * Отсортируйте полученный результат по итоговой сумме. */
	select order_num, sum(item_price) as "Итоговая сумма"
	from orderitems о
	where item_price >= money(35)
	group by order_num, item_price 
 
/* Задача 18: Осуществить выборку номера заказа, указать минимальную стоимость товара в заказе из таблицы orderitems. */
	select min(item_price)
	from orderitems o 
	
/* Задача 19: Осуществить выборку номера заказа, указать максимальную стоимость товара в заказе из таблицы orderitems. */
	select max(item_price)
	from orderitems o 

/* Задача 20: Осуществить выборку номера заказа, указать среднюю цену товара в заказе из таблицы orderitems. */
	select avg(item_price::numeric)
	from orderitems o

/* Задача 21: Осуществить выборку номера заказа, указать среднюю цену товара в заказе, сумму и количество товаров в заказе из таблицы orderitems. */
	select order_num, avg(item_price::numeric) as "Средняя цена", sum(item_price) as "Сумма товара", count(quantity) as "Количество товара"
	from orderitems o
	group by order_num 

/* Задача 22: Осуществить выборку номера заказа, указать минимальную, максимальную и среднюю стоимость товара в заказе из таблицы orderitems. */
	select order_num, min(item_price) as "Минимальная цена", max(item_price)  as "Максимальная цена", avg(item_price::numeric) as "Количество товара"
	from orderitems o
	group by order_num 

/* Задача 23: Осуществить выборку номера заказа, вычислить суммарную стоимость товаров, а также вычислить налог на добавленную стоимость для полученных сумм (имя столбца НДС),
* который включен в стоимость и составляет k = 18%, а также стоимость заказа (Стоимость_без_НДС) без него. Значения округлить до двух знаков после запятой. 
* Формулы для вычисления: НДС=(количество*цену*0,18)/1,18;  Стоимость_без_НДС = Общая_стоимость – НДС */
	
	select order_num, sum(item_price) as "Cуммарная стоимость товаров", round(AVG(quantity*(item_price::numeric)*0.18/1.18),2) as "Налог", 
	round(SUM(item_price::numeric),2) - round(AVG(quantity*(item_price::numeric)*0.18/1.18),2) as "Стоимость без НДС"
	from orderitems o 
	group by order_num, quantity, item_price 
	
/* Задача 24: Вычислить общее количество товаров, заказанных клиентами из таблицы orderitems */
	select order_num as "ID заказа", count(quantity) as "общее количество товаров"
	from orderitems o 
	group by order_num 

/* Задача 25: Вычислить общее количество записей в таблице products */
	select count(*) from products p 

/* Задача 26: Осуществить выборку номера заказа, указать общую стоимость заказа, минимальную, максимальную и среднюю стоимость товара в заказе из таблицы orderitems, 
 * если общая стоимость заказа > 50 */
	select order_num, sum(item_price) as "Общая стоимость",  min(item_price) as "Минимальная стоимость", max(item_price)  as "Максимальная стоимость", avg(item_price::numeric) as "Средняя стоимость товара"
	from orderitems o 
	where item_price > money(50)
	group by order_num, item_price  
	
/* Задача 27: Осуществить выборку номера заказа, указать минимальную, максимальную и среднюю стоимость товара в заказе из таблицы orderitems,
если стоимость товаров в заказе > 6 */
	select order_num, min(item_price), max(item_price), avg(item_price::numeric)
	from orderitems o 
	where item_price > money(6)
	group by order_num
	
/* Задача 28: Осуществить выборку номера заказа, указать минимальную, максимальную и среднюю стоимость товара в заказе из таблицы orderitems, 
 * если стоимость товаров в заказе > 50 и prod_id не является “FB” */
	select min(item_price) as "Минимальная стоимость", max(item_price)  as "Максимальная стоимость", avg(item_price::numeric) as "Средняя стоимость товара"
	from orderitems o 
	where item_price > money(50) and prod_id = 'FB'	is not null
